# üöÄ Tutorial de Deploy - Stellar Stake House

![Stellar Stake House Logo](./frontend/src/assets/logo.svg)

Guia completo para fazer deploy da aplica√ß√£o Stellar Stake House em produ√ß√£o.

## ‚úÖ **STATUS ATUAL: SISTEMA PRONTO PARA DEPLOY**

- ‚úÖ Frontend desenvolvido e testado
- ‚úÖ Backend com todas as APIs funcionais
- ‚úÖ Banco de dados Supabase configurado
- ‚úÖ Contratos Soroban deployados na testnet
- ‚úÖ Logo integrado em todas as p√°ginas
- ‚úÖ Documenta√ß√£o completa e atualizada

# Tutorial Completo: Stellar Stake House - Deploy e Pr√≥ximos Passos

## üìã √çndice
1. [Verifica√ß√£o do Estado Atual](#verifica√ß√£o-do-estado-atual)
2. [Como Executar o Projeto Localmente](#como-executar-o-projeto-localmente)
3. [Configura√ß√£o de Ambientes](#configura√ß√£o-de-ambientes)
4. [Deploy com Docker](#deploy-com-docker)
5. [Pr√≥ximos Passos](#pr√≥ximos-passos)
6. [Troubleshooting](#troubleshooting)

---

## üîç Verifica√ß√£o do Estado Atual

### ‚úÖ O que j√° est√° implementado:

#### Frontend (React + Vite + TailwindCSS)
- ‚úÖ Interface completa de autentica√ß√£o com carteiras Stellar
- ‚úÖ Dashboard principal com visualiza√ß√£o de staking
- ‚úÖ P√°ginas de hist√≥rico e recompensas
- ‚úÖ Sistema de notifica√ß√µes
- ‚úÖ Design responsivo e moderno
- ‚úÖ Integra√ß√£o com Freighter Wallet

#### Backend (Node.js + Express)
- ‚úÖ API REST completa
- ‚úÖ Autentica√ß√£o JWT
- ‚úÖ Integra√ß√£o com Supabase
- ‚úÖ Sistema de snapshots autom√°ticos
- ‚úÖ C√°lculo de recompensas
- ‚úÖ Middleware de seguran√ßa
- ‚úÖ Sistema de logs
- ‚úÖ Monitoramento de performance

#### Banco de Dados (Supabase/PostgreSQL)
- ‚úÖ Schema completo implementado
- ‚úÖ Tabelas para usu√°rios, staking, recompensas, snapshots
- ‚úÖ √çndices otimizados
- ‚úÖ Pol√≠ticas de seguran√ßa RLS

#### DevOps e Deploy
- ‚úÖ Dockerfiles para produ√ß√£o e desenvolvimento
- ‚úÖ Docker Compose para diferentes ambientes
- ‚úÖ Nginx configurado como load balancer
- ‚úÖ Pipeline CI/CD com GitHub Actions
- ‚úÖ Scripts de deploy automatizados
- ‚úÖ Configura√ß√µes de ambiente (.env)

---

## üèÉ‚Äç‚ôÇÔ∏è Como Executar o Projeto Localmente

## üìã Pr√©-requisitos

- ‚úÖ Node.js 18+ instalado
- ‚úÖ Docker configurado (opcional)
- ‚úÖ Conta no Vercel/Netlify (frontend)
- ‚úÖ Conta no Railway/Heroku (backend)
- ‚úÖ Projeto Supabase configurado e funcionando
- ‚úÖ Contratos Stellar deployados
- ‚úÖ Vari√°veis de ambiente configuradas

### Verifica√ß√£o dos Pr√©-requisitos
```bash
# Verificar se o Node.js est√° instalado (vers√£o 18+)
node --version

# Verificar se o npm est√° instalado
npm --version

# Verificar se o Docker est√° instalado (opcional)
docker --version
docker-compose --version
```

### M√©todo 1: Execu√ß√£o Tradicional (Desenvolvimento)

#### 1. Configurar o Backend
```bash
# Navegar para o diret√≥rio do backend
cd backend

# Instalar depend√™ncias
npm install

# Copiar arquivo de ambiente
cp .env.example .env

# Editar o arquivo .env com suas configura√ß√µes
# Voc√™ precisa configurar:
# - SUPABASE_URL
# - SUPABASE_ANON_KEY
# - JWT_SECRET
# - SESSION_SECRET
```

#### 2. Configurar o Frontend
```bash
# Em outro terminal, navegar para o frontend
cd frontend

# Instalar depend√™ncias
npm install

# Copiar arquivo de ambiente
cp .env.example .env

# Editar o .env com a URL do backend
# VITE_API_URL=http://localhost:3001
```

#### 3. Executar os Servi√ßos
```bash
# Terminal 1: Backend
cd backend
npm run dev
# Servidor rodando em: http://localhost:3001

# Terminal 2: Frontend
cd frontend
npm run dev
# Aplica√ß√£o rodando em: http://localhost:5173
```

### M√©todo 2: Execu√ß√£o com Docker (Recomendado)

#### 1. Configurar Ambientes
```bash
# Copiar arquivos de ambiente
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env

# Editar os arquivos .env conforme necess√°rio
```

#### 2. Executar com Docker Compose
```bash
# Para desenvolvimento
docker-compose -f docker-compose.dev.yml up --build

# Para produ√ß√£o local
docker-compose up --build
```

#### 3. Verificar se est√° funcionando
```bash
# Verificar containers rodando
docker ps

# Verificar logs
docker-compose logs -f

# Acessar:
# Frontend: http://localhost:3000
# Backend: http://localhost:3001
# Nginx: http://localhost (se usando produ√ß√£o)
```

---

## ‚öôÔ∏è Configura√ß√£o de Ambientes

### üîß Configura√ß√£o do Supabase

1. **Criar conta no Supabase**
   - Acesse: https://supabase.com
   - Crie uma conta gratuita
   - Crie um novo projeto

2. **Configurar o banco de dados**
   ```sql
   -- Execute o script em database/schema.sql no SQL Editor do Supabase
   -- Isso criar√° todas as tabelas necess√°rias
   ```

3. **Obter credenciais**
   - V√° em Settings > API
   - Copie a URL do projeto - https://psqcaaydgginbomikotq.supabase.co
   - Copie a chave anon/public - eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzcWNhYXlkZ2dpbmJvbWlrb3RxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyODIwMzYsImV4cCI6MjA3Mjg1ODAzNn0.fsUEy9nQFViIcrj84djS30eQAFRlGHqK_bhuMY_yrY8
   - Copie a chave service_role (para o backend) - eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzcWNhYXlkZ2dpbmJvbWlrb3RxIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzI4MjAzNiwiZXhwIjoyMDcyODU4MDM2fQ.8124CA6-GUXzA-U2XmMkd63bbKMAuB_k6NBeHBEE53U

4. **Configurar RLS (Row Level Security)**
   ```sql
   -- Habilitar RLS nas tabelas sens√≠veis
   ALTER TABLE users ENABLE ROW LEVEL SECURITY;
   ALTER TABLE staking_positions ENABLE ROW LEVEL SECURITY;
   ALTER TABLE rewards ENABLE ROW LEVEL SECURITY;
   
   -- Criar pol√≠ticas de acesso
   -- (Pol√≠ticas j√° est√£o no schema.sql)
   ```

### üåü Configura√ß√£o da Stellar Network

1. **Para Testnet (Desenvolvimento)**
   ```env
   STELLAR_NETWORK=testnet
   STELLAR_HORIZON_URL=https://horizon-testnet.stellar.org
   ```

2. **Para Mainnet (Produ√ß√£o)**
   ```env
   STELLAR_NETWORK=mainnet
   STELLAR_HORIZON_URL=https://horizon.stellar.org
   ```

### üîê Configura√ß√£o de Seguran√ßa

1. **Gerar segredos seguros**
   ```bash
   # Gerar JWT_SECRET
   node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
   
   # Gerar SESSION_SECRET
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```

2. **Configurar CORS**
   ```env
   # Para desenvolvimento
   CORS_ORIGIN=http://localhost:5173
   
   # Para produ√ß√£o
   CORS_ORIGIN=https://seudominio.com
   ```

---

## üê≥ Deploy com Docker

### Deploy Local (Teste de Produ√ß√£o)

```bash
# 1. Construir e executar
./deploy.sh dev

# 2. Verificar se est√° funcionando
curl http://localhost:3001/health
curl http://localhost:3000

# 3. Verificar logs
docker-compose logs -f
```

### Deploy em Servidor (VPS/Cloud)

#### 1. Preparar o servidor
```bash
# Instalar Docker e Docker Compose
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# Instalar Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### 2. Clonar o projeto
```bash
git clone https://github.com/seu-usuario/stellar-stake-house.git
cd stellar-stake-house
```

#### 3. Configurar ambiente de produ√ß√£o
```bash
# Copiar e editar arquivos de ambiente
cp backend/.env.example backend/.env-prod
cp frontend/.env.example frontend/.env

# Editar com configura√ß√µes de produ√ß√£o
nano backend/.env-prod
nano frontend/.env
```

#### 4. Executar deploy
```bash
# Dar permiss√£o ao script
chmod +x deploy.sh

# Executar deploy de produ√ß√£o
./deploy.sh prod
```

#### 5. Configurar dom√≠nio e SSL
```bash
# Instalar Certbot para SSL
sudo apt install certbot python3-certbot-nginx

# Obter certificado SSL
sudo certbot --nginx -d seudominio.com

# Configurar renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar: 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## üöÄ Pr√≥ximos Passos

### 1. üîß Configura√ß√µes Essenciais

#### A. Configurar Supabase
- [ ] Criar projeto no Supabase
- [ ] Executar script `database/schema.sql`
- [ ] Configurar pol√≠ticas RLS
- [ ] Obter credenciais de API

#### B. Configurar Vari√°veis de Ambiente
- [ ] Editar `backend/.env-prod` com credenciais reais
- [ ] Configurar `frontend/.env` com URL de produ√ß√£o
- [ ] Gerar segredos JWT seguros
- [ ] Configurar URLs do Stellar (testnet/mainnet)

### 2. üåê Deploy em Produ√ß√£o

#### A. Escolher Provedor de Hospedagem
**Op√ß√µes Recomendadas:**
- **DigitalOcean Droplet** (VPS simples)
- **AWS EC2** (escal√°vel)
- **Google Cloud Run** (serverless)
- **Vercel + Railway** (frontend + backend)

#### B. Configurar Dom√≠nio
- [ ] Registrar dom√≠nio
- [ ] Configurar DNS
- [ ] Configurar SSL/HTTPS
- [ ] Configurar CDN (opcional)

#### C. Executar Deploy
```bash
# No servidor de produ√ß√£o
git clone https://github.com/seu-usuario/stellar-stake-house.git
cd stellar-stake-house
./deploy.sh prod
```

### 3. üîç Monitoramento e Logs

#### A. Configurar Monitoramento
- [ ] Configurar alertas de sa√∫de
- [ ] Monitorar uso de recursos
- [ ] Configurar backup autom√°tico
- [ ] Implementar m√©tricas de neg√≥cio

#### B. Logs e Debugging
```bash
# Visualizar logs em tempo real
docker-compose logs -f

# Logs espec√≠ficos do backend
docker-compose logs backend

# Logs espec√≠ficos do frontend
docker-compose logs frontend

# Entrar no container para debug
docker-compose exec backend bash
```

### 4. üß™ Testes em Produ√ß√£o

#### A. Testes Funcionais
- [ ] Testar autentica√ß√£o com Freighter
- [ ] Testar opera√ß√µes de staking
- [ ] Testar c√°lculo de recompensas
- [ ] Testar hist√≥rico de transa√ß√µes

#### B. Testes de Performance
```bash
# Teste de carga simples
npm install -g artillery
artillery quick --count 10 --num 5 http://localhost:3001/health

# Monitorar recursos
docker stats
```

### 5. üîê Seguran√ßa em Produ√ß√£o

#### A. Checklist de Seguran√ßa
- [ ] HTTPS configurado
- [ ] Firewall configurado
- [ ] Rate limiting ativo
- [ ] Logs de seguran√ßa
- [ ] Backup de dados
- [ ] Monitoramento de intrus√£o

#### B. Auditoria de Seguran√ßa
```bash
# Verificar vulnerabilidades
npm audit

# Verificar configura√ß√µes Docker
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  -v $PWD:/root/.docker \
  aquasec/trivy image stellar-stake-house_backend
```

### 6. üìà Otimiza√ß√µes

#### A. Performance
- [ ] Configurar cache Redis
- [ ] Otimizar consultas de banco
- [ ] Implementar CDN
- [ ] Comprimir assets

#### B. Escalabilidade
- [ ] Configurar load balancer
- [ ] Implementar auto-scaling
- [ ] Configurar m√∫ltiplas inst√¢ncias
- [ ] Otimizar banco de dados

---

## üÜò Troubleshooting

### Problemas Comuns

#### 1. Erro de Conex√£o com Supabase
```bash
# Verificar configura√ß√µes
echo $SUPABASE_URL
echo $SUPABASE_ANON_KEY

# Testar conex√£o
curl -H "apikey: $SUPABASE_ANON_KEY" $SUPABASE_URL/rest/v1/
```

#### 2. Erro de Autentica√ß√£o Stellar
```bash
# Verificar se Freighter est√° instalado
# Verificar se est√° na rede correta (testnet/mainnet)
# Verificar logs do browser (F12)
```

#### 3. Containers n√£o iniciam
```bash
# Verificar logs
docker-compose logs

# Reconstruir containers
docker-compose down
docker-compose up --build

# Limpar cache Docker
docker system prune -a
```

#### 4. Erro de CORS
```bash
# Verificar configura√ß√£o CORS_ORIGIN
# Verificar se frontend est√° na URL correta
# Verificar headers de resposta
curl -H "Origin: http://localhost:5173" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: X-Requested-With" \
     -X OPTIONS \
     http://localhost:3001/api/auth/login
```

### Comandos √öteis

```bash
# Verificar status dos servi√ßos
docker-compose ps

# Reiniciar servi√ßo espec√≠fico
docker-compose restart backend

# Verificar uso de recursos
docker stats

# Backup do banco de dados
pg_dump $DATABASE_URL > backup.sql

# Restaurar backup
psql $DATABASE_URL < backup.sql

# Verificar conectividade de rede
docker-compose exec backend ping frontend

# Executar testes
npm test

# Verificar qualidade do c√≥digo
npm run lint
```

---

## üìû Suporte

Se encontrar problemas:

1. **Verificar logs**: `docker-compose logs -f`
2. **Consultar documenta√ß√£o**: Verificar README.md de cada m√≥dulo
3. **Verificar issues**: GitHub Issues do projeto
4. **Comunidade Stellar**: https://stellar.org/developers
5. **Documenta√ß√£o Supabase**: https://supabase.com/docs

---

## üéâ Conclus√£o

Seu projeto Stellar Stake House est√° completo e pronto para produ√ß√£o! üöÄ

**Pr√≥ximos passos imediatos:**
1. Configurar Supabase
2. Configurar vari√°veis de ambiente
3. Executar deploy local para testes
4. Deploy em produ√ß√£o
5. Configurar monitoramento

**Lembre-se:**
- Sempre teste em ambiente de desenvolvimento primeiro
- Use testnet antes de ir para mainnet
- Mantenha backups regulares
- Monitore logs e m√©tricas
- Mantenha depend√™ncias atualizadas

Boa sorte com seu projeto! üåü